# 目的

広聴AIやいどばたに応用できるファクトチェックの共通処理を作りたい

https://github.com/digitaldemocracy2030/kouchou-ai/issues/324

# 進め方

- テスト用のコメントのセットを用意する　→ ひとまずcomments.pyのダミーデータ使う
- 各コメントに対して、以下の正解を手動で用意する　→ ひとまずcomments.pyのダミーデータ使う
    - 前処理結果（ファクト的な文言の抽出）
    - 正誤判定
    - 判定理由区分
    - 判定理由詳細
- ファクトチェック処理を最適化する
    - 複数の方法でファクトチェックを実装し、処理時間/API費用/精度を比較する　→ 実行中

# 進捗　2025/04/23

- テストデータは作成済み（_input/comments.py）
- 超ざっくり実装し始めて動かしたところ、案の定単純Web検索とWikipedia検索は精度が低かった
- 今後は単純LLM、ファクトチェックAPI、DeepResearchの3種類について本格的に実装する

# 要検討事項

- 共通問題
    - 前処理どうするか？
        - 生のコメントからファクトチェックすべき部分を抽出するのは難しい。
            - 「AだからBだ」→ Aである、自体もチェック対象？
            - 「AなBが好き」→ BがAである、自体もチェック対象？それとも「もしBがAなら好き」と解釈して対象外？
        - 広聴AIやいどばたの既存の仕組みに乗っかり、ここでは前処理後のコメントのみを扱う、でいいか？
        - 生コメントに根拠（引用、返信元、出典、リンクなど）がある場合、それを優先的に調べたいが、↑だと扱われてなさそう？
    - 判定の考え方をどうするか？
        - 手動判定でも迷う
            - 「Aは必ずBだ」→ 99%正しい場合、「AはBだ」ならOKかもだが「必ず」が入るのでNG？
            - 「Aは必ずしもBでない」→ BでないAの実例がないが、ないとも証明できない場合は？
            - 「宇宙人に支配された日本は終わりだ。」をどう判断すべきか？
                - 「日本は宇宙人に支配されている。したがって終わりだ。」と解釈し、前段が事実に反するので偽？
                - 「もし日本が宇宙人に支配されたら、終わる。」と解釈すると、「終わる」の文脈次第で真偽が変わるので未確定？
                - 「もし日本が宇宙人に支配されたら、終わる。」と解釈するが、前提命題が偽なので論理命題としては真？
                - 「宇宙人」が地球外生命体ではなく比喩表現かもしれないので、未確定？
        - 「偽と確定できるものだけ弾く」大方針に従うなら、「偽と確定しない判定方法があるなら弾かない」が正解か？どこまで厳密にやるべきか・・
    - プロンプト関連
        - 各種プロンプトの精度向上
        - コメント数の何倍もLLMにAPI投げたくないので、まとめて処理する工夫など必要そう
    - LLMの種類
        - ひとまず OpenAI API の o4-mini
    - 判定基準系
        - 真実性の判定方法どうしよう　今は Truthinessのenumに適当に分類してる
            - とりあえずそのまま進めて、LLMの場合は理由も記録しておく
        - 評価指標どうしよう
            - 偽コメントを見逃すより、偽と確定できないコメントを偽と判定する方がNGにしたい

- ファクトチェック処理別の検討事項
    - 既存のファクトチェックサービス
        - どれ使う？比較したい
        - 便利だけど、カバーされない偽情報が多く出そう
    - 固定サイトで確認
        - どれ使う？暫定的にWikipedia入れたが怒られそう
    - LLMに直接聞く
        - 怒られるやつ。でも最近賢いので一応
    - 既存のDeepResearch、推論モデル
        - どれ使う？比較したい
    - 自前でDeepResearch作る
        - 一段大変なのと、他の結果が出揃ってからやった方が良さそうなので、後回し

# 環境構築

- .env.sample をコピーして .env ファイルを作り、自身の OPENAI_API_KEY を記載する
- `pip3 install python-dotenv requests openai pandas`
